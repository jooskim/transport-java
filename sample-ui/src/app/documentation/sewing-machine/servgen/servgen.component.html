<h1>ServGen - CLI</h1>

<h3>The Service Adapter Generation Engine.</h3>

<p>
    In the suite of components that make up the <strong class="emphasis">Intent Compiler</strong>  we call <strong
    class="emphasis">Sewing Machine</strong>, the role of <strong class="emphasis">ServGen</strong> is to autogenerate
    <strong class="emphasis">Service Adapters</strong> from
    supported API specification documents as well as appFabric <strong class="emphasis">Service Adapter Specification Document(s)</strong> into one or more service adapters
    and also generate appFabric API specification documents for these service adapters for consumption by downstream
    compiler components in the compiler's pipeline. This component is also the 3rd stage of the compiler’s pipeline.
</p>

<hr/>

<h2>
    Specifications and Languages
</h2>

<p>
    ServGen is agnostic to the type of API specification documents it indirectly consumes, and depends on <strong
    class="emphasis">libswagger</strong> for
    parsing them and transforming them into a set of abstractions that it can build on. This allows new types of
    API specification documents to be added, or the existing ones modified, or document parsing libraries changed, without
    affecting ServGen.
</p>
<p>
    At the time of writing this, <strong class="emphasis">libswagger</strong> understands <strong
    class="emphasis">Swagger 2.0</strong> and <strong class="emphasis">OpenAPI 3.0</strong> documents. The
    inclusion of Protocol Buffers as used by gRPC is envisioned in the roadmap.
</p>

<p>
    Additionally, ServGen also requires <strong class="emphasis">Service Adapter Specification Document(s)</strong>
    in JSON format in order to generate service adapters. The content of these documents are described in
    <strong class="emphasis">ServGen - Understanding</strong>
</p>

<p>
    As with all compiler components, ServGen employs a plugin strategy to generate service adapters in either Typescript or in Java
    using identical specification documents.
</p>

<hr/>

<h2>
    Using ServGen
</h2>

<p>
    The following is a detailed description of how to invoke ServGen (obsolete and deprecated options have been
    excluded):
</p>

<pre class="code"><code class="language-go" ngNonBindable>Usage: servgen [-BcdDFhHNQrTtvVw]
        [-a "@vmc"] [-b $&#123;HOME&#125;/ui] [-E Edrs:FeaturesOperator] [-e vmc] [-i value]
        [-l typescript | java] [-n Base] [-p &lt;YAML folder&gt;] [-P com.vmware.services]
        [-R ngw:NGW] [-s src/services] [-S value] [-y "-api-doc.yaml"]

 -a, --alias="@vmc"                 Alias for imports
 -B, --bifrost-abstractions         Obtain abstraction classes from Bifröst
 -b, --root=$&#123;HOME&#125;/ui              Project Root
 -c, --compatibility                Compatibility Mode
 -d, --debug                        Debug Output
 -D, --dump-service                 Dump detailed service data
 -e, --extern=vmc                   Extern YAML
 -F, --force                        Overwrite custom services and classes
 -h, --help                         Display Help from both the Bifröst as well as locally
 -i, --interface-dir=value          Directory for autogenerated service interface YAMLs relative to servicedir
 -l, --language=typescript | java   Codegen Language
 -n, --namespace=Base               Namespace prefix
 -N, --no-detailed-statistics       Display summary statistics only
 -p, --apiDir=&lt;YAML folder&gt;         YAML folder  (relative to project root)
 -P, --package=com.vmware.services  Package (for java)
 -Q, --quiet                        Suppress diagnostic warnings
 -r, --recover                      Continue on error
 -R, --rename-yaml=ngw:NGW          Prepend all objects in specified YAML with prefix
 -s, --servicedir=src/services      Services root
 -S, --specdir=value                Services spec (e.g. sddc-core
 -T, --test-stub                    Generate a stub for custom unit tests
 -t, --trace                        Trace Output
 -v, --verbose                      Verbose Output
 -V, --version                      Show Version
 -w, --no-warnings                  Turn off warnings
 -y, --yaml-suffix="-api-doc.yaml"  Suffix to convert YAML file names to api.[ts | java]</code></pre>

<table class="table table-noborder flag-table">
    <thead>
    <tr>
        <th class="left flag-header">Flag</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="left flag">-a, | --alias=@vmc</td>
        <td class="flag-value">
            Typescript only. Specifies a shortcut alias to be used for imports.
            Ignored in Java.
        </td>
    </tr>
    <tr>
        <td class="left flag">-B | --bifrost-abstractions</td>
        <td class="flag-value">
            Most projects should use this flag. It specifies that all autogeneration abstractions
            should be obtained from the Bifröst core. If not specified, then these abstractions are
            sought locally. At the time of writing this, VMC is the only project using local
            abstractions for historical reasons. Once VMC has been refactored to no longer depend
            on local abstractions, this flag will be ignored and always assumed to be on.
        </td>
    </tr>
    <tr>
        <td class="left flag">-b&lt;path&gt; | --root=&lt;path&gt;</td>
        <td class="flag-value">This option declares the absolute path to the root of the Project directory. All
            subsequent location
            specifications are relative to this root path. If this option is skipped, ServGen defaults to <strong
                class="emphasis">$&#123;HOME&#125;/ui</strong> for
            historical reasons. Path specifications may include the ~ character which will be replaced by the <strong
                class="emphasis">HOME</strong>
            folder of the invoking user, or <strong class="emphasis">~&lt;user&gt;</strong>, which will be replaced by
            the <strong class="emphasis">HOME</strong> folder of the specified
            <strong class="emphasis">&lt;user&gt;.</strong>
        </td>

    </tr>
    <tr>
        <td class="left flag">-d | --debug</td>
        <td class="flag-value">
            Used by ServGen developers to emit debug output.
        </td>
    </tr>
    <tr>
        <td class="left flag">--e &lt;YAML prefix&gt; | --extern=&lt;YAML prefix&gt;</td>
        <td class="flag-value">
            Many of the YAML specifications prevalent at VMware use partial object definitions with the intent that a
            more authoritative definition is to be obtained from another YAML. Examples of this behavior include the
            definition of the <strong class="emphasis">Task</strong> class and <strong class="emphasis">Sddc</strong>
            class, that are both authoritatively defined in <strong class="emphasis">vmc-api-doc.yaml</strong>, but
            has partial definitions in other YAML files (e.g. <strong class="emphasis">vmc-draas-api-doc.yaml</strong>).
            When this option is specified.
            <br/><br/>
            ServGen does not emit any definition for object names that are duplicated in the authoritative YAML (in this
            case vmc, without the suffix) and instead, issues import declarations (in the respective output language)
            for those duplicated objects from their definition in the authoritative YAML.
        </td>
    </tr>
    <tr>
        <td class="left flag">-F | --force</td>
        <td class="flag-value">
            Usually, this flag is provided to an Intent Compiler component (e.g. <strong
            class="emphasis">ServGen</strong>, or <strong class="emphasis">SpecGen</strong>)
            to permit them to overwrite a file that is otherwise customizable (and therefore, not normally overwritten),
            however, it should never be used in production code and is only provided for developer convenience.
        </td>
    </tr>
    <tr>
        <td class="left flag">-h | --help</td>
        <td class="flag-value">
            Displays all the options recognized by ServGen.
        </td>
    </tr>
    <tr>
        <td class="left flag">-i &lt;path&gt; | --interface-dir=&lt;path&gt;</td>
        <td class="flag-value">
            Once ServGen has finished building a service adapter, it also generates appFabric API specification
            documents that allow requests and responses to/from the service by any consumer over the event bus.
            These interface documents are also used for the next stage of the compiler, <strong class="emphasis">Modelgen</strong>,
            which typically does not execute in the local address space of the service adapter, to autogenerate local
            bindings for the consumer to procedurally invoke requests on the event bus.
            <br><br>
            This option specifies the path, relative to the location of service-dir described below, where these interfaces documents,
            one per service adapter, are to be created. If the folder does not exist, it is created, otherwise all the content of an
            existing folder are purged.

        </td>
    </tr>
    <tr>
        <td class="left flag">-l &lt;typescript | java&gt; | --language=&lt;typescript | java &gt;</td>
        <td class="flag-value">
            This option is used to specify the language plugin to be used for the output from ServGen. Currently, the
            valid plugins are: <strong class="emphasis">typescript</strong>, and <strong class="emphasis">java</strong>.
        </td>
    </tr>

    <tr>
        <td class="left flag">-N | --no-detailed-statistics</td>
        <td class="flag-value">
            Without this option, ServGen prints out detailed compiler statistics for every processed service adapter.
            Turning this flag on results in only a small amount of statistics that summarizes the statistics for all
            processed service adapters into a single synopsis.

        </td>
    </tr>

    <tr>
        <td class="left flag">-n | --namespace=&lt;prefix&gt;</td>
        <td class="flag-value">
            This option prepends a prefix to every class definition output by ServGen. If this option is not provided,
            ServGen defaults to using Base as that prefix. The purpose of this is to rename the class names sent by a
            responder and preserve that intact, while deriving a new class from this base class by the application, and
            delineates the boundary of immutability of the original class.
            <br/><br/>
            References to this base class may only be
            permitted from Service Adapters, and never from the application itself. The application may, however, access
            the derived class[es] provided by <strong class="emphasis">ServGen</strong>, which automatically generates
            the children of this parent base
            class, while the base class output of ServGen is only accessible from within the Service Adapter and may be
            in a language that is different from that of the application
        </td>
    </tr>

    <tr>
        <td class="left flag">-P &lt;package name&gt; | --package=&lt;package name&gt;</td>
        <td class="flag-value">
            For languages that use packages, e.g. Java, Go, etc., this specifies the package name to insert in the
            output file(s) as it is not always possible to infer the package name from the output folder’s path.
        </td>
    </tr>

    <tr>
        <td class="left flag">-p &lt;relative path&gt; | --apiDir=&lt;relative path&gt;</td>
        <td class="flag-value">
            This option is mandatory and specifies the path of the <strong class="emphasis">api</strong> folder, <strong
            class="emphasis">relative</strong> to the project root specified
            using <code class="clr-code">–root</code> above. The <strong class="emphasis">api</strong> folder is the
            location where both YAML files and the runtime bindings generated by APIGen reside.
        </td>
    </tr>

    <tr>
        <td class="left flag">-Q | --quiet</td>
        <td class="flag-value">
            Suppresses diagnostic warnings. This is a developer aid and should never be specified in production mode.

        </td>
    </tr>

    <tr>
        <td class="left flag">-R &lt;YAML : class prefix&gt; --rename-yaml=&lt;YAML : class prefix&gt;</td>
        <td class="flag-value">
            Since there is no central repository for YAML files, sometimes the same name is used in more than one file,
            causing a name collision for Intent Compiler components like <strong class="emphasis">APIGen</strong> and
            <strong class="emphasis">ServGen</strong> that simultaneously operate on multiple
            YAML files within the same namespace. The <code class="clr-code">–rename-yaml</code> option. Specifies the
            prefix of a YAML file separated
            from a string by a colon “:” that is then prepended to every class name in the specified YAML.
            <br/><br/>
            As an
            example, a class named <code class="clr-code">Message</code> exists in both vmc-api-doc.yaml as well as
            ngw-api-doc.yaml but they are not
            the same object. To resolve this name collision, <code class="clr-code">--rename-yaml=ngw:NGW</code>
            prepends <code class="clr-code">NGW</code> to every class in
            <code class="clr-code">ngw-api-doc.yaml</code>, so that <code class="clr-code">Message</code> is renamed to
            <code class="clr-code">NGWMessage</code> in ngw-api-doc.yaml, while leaving Message
            unchanged in vmc-api-doc.yaml, thus avoiding the name collision.
            <br/><br/>
            <div class="alert alert-info" role="alert">
                <div class="alert-items">
                    <div class="alert-item static">
            <span class="alert-text">
            <code class="clr-code">Note:</code> This option must be specified to both <strong class="emphasis">APIGen</strong> and <strong class="emphasis">ServGen</strong>.
            Currently, only one YAML/class pair can be specified. A future version will allow for multiple such pairs to be specified.
            </span>
                    </div>
                </div>
        </div>
        </td>
    </tr>

    <tr>
        <td class="left flag">-r | --recover</td>
        <td class="flag-value">
            Normally, ServGen will stop processing an exit when it encounters an error. With this option, it
            will try to continue processing the remaining service adapters even if it fails to process one of them.
            Do not specify this for production code.

        </td>
    </tr>

    <tr>
        <td class="left flag">-S &lt;Service Adapter&gt;, --specdir=&lt;Service Adapter&gt;</td>
        <td class="flag-value">
            Normally, ServGen will process specifications for every service adapter folder with a <code class="clr-code">specs</code>
            sub-folder that it finds in <code class="clr-code">--servicedir</code> described below. This option dictates
            that only the service adapter specified here be processed. This is a legacy option from the past when ServGen
            was originally written in Python, and would take several minutes for ServGen to process a handful of service adapters.
            ServGen was redesigned and rewritten in <code class="clr-code">golang</code> and can process all the service
            adapters in VMC (about 27 at the time of writing this) in less than 1 second.
            <br><br>
            Nowadays, this option is only useful for Sewing Machine developers when debugging ServGen.
            <div class="alert alert-info" role="alert">
                <div class="alert-items">
                    <div class="alert-item static">
                        <span class="alert-text">
                            <code class="clr-code">Note:</code> The name of the folder for a service adapter must be identical to the name of
                            the service adapter itself. Since service adapter class names in Java must be in PascalCase,
                            the service adapter folder must be PascalCase also.
                            For Typescript, the convention is to have service adapter names be in kebab-case, e.g. <code class="clr-code">sddc-core</code>
                            is the name of the service adapter and its containing folder, however, the autogenerated class is
                            <code class="clr-code">SddcCoreService</code>, while the service adapter's name remains <code class="clr-code">sddc-core</code>.
                            For Java, both the service adapter folder and the service adapter name must be <code class="clr-code">SddcCore</code>
                            and will also generate a service adapter called <code class="clr-code">SddcCoreService</code>.
                        </span>
                    </div>
                </div>
            </div>
        </td>
    </tr>

    <tr>
        <td class="left flag">-s src/services, --servicedir=src/services</td>
        <td class="flag-value">
            This option specifies a folder relative to the project's root folder, which contains all the sub-folders for
            the service adapters, including <code class="clr-code">--apiDir</code>. For every service adapter that is to
            be processed by ServGen, it looks for a sub-folder named <code class="clr-code">specs</code>, which contains
            one or more service adapter specification documents. The details of these specification documents is described in detail later.
        </td>
    </tr>

    <tr>
        <td class="left flag">-T | --test-stubs</td>
        <td class="flag-value">
            ServGen automatically generates unit tests for every service request to every service adapter. These test files cannot be
            modified directly as they are regenerated each time that ServGen runs. Using this option, a
            <code class="clr-code">customizable test stub</code> is generated which can be used to write additional tests, particularly
            for <code class="clr-code">customizable service adapters</code> described in detail later.
        </td>
    </tr>

    <tr>
        <td class="left flag">-t | --trace</td>
        <td class="flag-value">
            Used by ServGen developers to emit trace level output.
        </td>
    </tr>

    <tr>
        <td class="left flag">-V | --version</td>
        <td class="flag-value">
            Displays ServGen version.
        </td>
    </tr>

    <tr>
        <td class="left flag">-v | --verbose</td>
        <td class="flag-value">
            Used by ServGen developers to emit verbose level output.
        </td>
    </tr>

    <tr>
        <td class="left flag">-w | --no-warnings</td>
        <td class="flag-value">
            option suppresses warning from ServGen (not recommended, except while debugging, and overwhelmed by a stream
            of warnings).
        </td>
    </tr>

    <tr>
        <td class="left flag">-y "-api-doc.yaml" | --yaml-suffix="-api-doc.yaml"</td>
        <td class="flag-value">
            By convention, all API specification documents are expected to have <code class="clr-code">-api-doc.yaml</code>
            as the suffix for the filename that contains them. This option allows for a different name pattern to be
            sought by ServGen.
        </td>
    </tr>

    </tbody>
</table>


<hr/>

<h2>
   Example Use
</h2>

<h3>
    VMC UI using Typescript
</h3>
<pre class="code"><code class="language-bash" ngNonBindable>servgen2 -R ngw:NGW -N -i interfaces -T -p src/services/api -e vmc -s src/services --root=~/ui</code></pre>



<h3>
    AppFabric sample using Java
</h3>
<pre class="code"><code class="language-bash" ngNonBindable>servgen2 -l java \
    -P com.vmware.appfabric.sample -T -B -N -i interfaces -p services/api \
    --root=~/appFabric/sample-ui -s src/services
</code></pre>
