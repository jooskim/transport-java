<h1>Service Adapter Specification</h1>

<h3>Specification Document: sets.json</h3>

<p>
    By convention, <code class="clr-code">sets.json</code> contains the specifications for generating language-neutral
    <code class="clr-code">sets</code> of typed objects for internal use by the Service Adapter, either for customized code,
    or for custom tests. A later chapter will discuss in detail the autogenerated code. A <code class="clr-code">set</code>
    is an abstract container that can be tested for the presence of an <code class="clr-code">item</code> and follows
    the same pattern as <code class="clr-code">arrays</code> described in the previous chapter.
</p>

<p>
    It should be noted that the autogenerated sets are not exposed in the Service Adapter Interface (YAML), and therefore,
    such sets are not directly accessible from the application layer. Moreover, sets are currently not supported for
    Service Adapters written in Java.
    <br/><br/>
    Sets are a legacy implementation which had hoped to be transportable across multiple languages. We are seeing
    problems in creating standalone sets (not wrapped in a class) in languages other than Typescript (golang doesn't support sets), so it may be preferable to use
    <code class="clr-code">custom code</code> instead. In the meantime, we are investigating whether we can come
    up with an alternate solution.
</p>

<p>
    Here is an example of a set excerpted from the <strong class="emphasis">sddc-core</strong> Service Adapter:
</p>

<pre class="code" ><code class="language-json" ngNonBindable>
&#123;
    "sets": [
        &#123;
            "set": "SddcReadyStatuses",
            "imports": [
                &#123; "import": "SddcStatus" &#125;
            ],
            "items": [
                &#123; "item": "SddcStatus.Ready" &#125;,
                &#123; "item": "SddcStatus.DeployingHosts" &#125;,
                &#123; "item": "SddcStatus.DeletingHosts" &#125;,
                &#123; "item": "SddcStatus.CreatingCluster" &#125;,
                &#123; "item": "SddcStatus.DeletingCluster" &#125;,
                &#123; "item": "SddcStatus.DeployHostsCanceling" &#125;,
                &#123; "item": "SddcStatus.DeleteHostsCanceling" &#125;,
                &#123; "item": "SddcStatus.CreateClusterCanceling" &#125;,
                &#123; "item": "SddcStatus.DeleteClusterCanceling" &#125;,
                &#123; "item": "SddcStatus.DeployHostsFailed" &#125;,
                &#123; "item": "SddcStatus.DeleteHostsFailed" &#125;,
                &#123; "item": "SddcStatus.DeleteClusterFailed" &#125;,
                &#123; "item": "SddcStatus.CreateClusterFailed" &#125;,
                &#123; "item": "SddcStatus.DeployHostsCanceled" &#125;,
                &#123; "item": "SddcStatus.DeleteHostsCanceled" &#125;,
                &#123; "item": "SddcStatus.CreateClusterCanceled" &#125;,
                &#123; "item": "SddcStatus.DeleteClusterCanceled" &#125;,
                &#123; "item": "SddcStatus.SrmActivateStarted" &#125;,
                &#123; "item": "SddcStatus.SrmActivateFinished" &#125;,
                &#123; "item": "SddcStatus.SrmActivateFailed" &#125;,
                &#123; "item": "SddcStatus.SrmDeactivateStarted" &#125;,
                &#123; "item": "SddcStatus.SrmDeactivateFinished" &#125;,
                &#123; "item": "SddcStatus.SrmDeactivateFailed" &#125;
            ]
        &#125;,
</code></pre>
<p>
    In the above, we have specified that we want to create a set named <code class="clr-code">SddcReadyStatuses</code>
    that contains objects of "type" <code class="clr-code">string</code> (since no <code class="clr-code">CommonType</code> was specified).
    Below is a detailed description of the various properties for specifying a set:
</p>
<table class="table table-noborder flag-table">
    <thead>
    <tr>
        <th class="left flag-header">Property</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="left flag">sets</td>
        <td class="flag-value">This property specifies an array of custom sets. These sets are only for use within the Service
            Adapter or its custom tests. The instantiated set is not exposed in the Service Interface Document and is, therefore,
            not referable from the application layer.
        </td>
    </tr>
    <tr>
        <td class="left flag">set</td>
        <td class="flag-value">This property specifies the name of each set that is to be instantiated. This name is
            referable from the Service Adapter and its mocks and tests, but is not exposed in the Service Adapter Interface
            Document.
        </td>
    </tr>
    <tr>
        <td class="left flag">type</td>
        <td class="flag-value">This property specifies the "type" of the <strong class="emphasis">items</strong> in the set.
            The type specification uses <code class="clr-code">CommonType</code> described in previous chapters, however,
            <code class="clr-code">nested</code> is not permitted here since that would exceed the maximum nesting depth
            for a container (set is already a container).
        </td>
    </tr>
    <tr>
    <tr>
        <td class="left flag">imports</td>
        <td class="flag-value">Typically, in autogenerating a set, <strong class="emphasis">ServGen</strong> is able to infer the
            location where all references within the array are defined. In some cases, however, as in the example above, some help is
            required in the form of <code class="clr-code">import</code> specifications to determine the location of some definitions.
            <br/><br/>
            This property contains a set of identifiers to be searched for definitions. The identifier is declared using the
            <code class="clr-code">import</code> property, while the location is the Service Adapter where it is defined using
            the <code class="clr-code">service</code> property.  Ommision of the <code class="clr-code">service</code>
            property indicates that the symbol is to be searched for in the current Service Adapter. Instead of providing a location using the
            <code class="clr-code">service</code> property, it is also possible to provide an absolute or relative path to a file
            using the <code class="clr-code">path</code> property. See the example for this in the previous chapter for <code class="clr-code">arrays</code>.
        </td>
    </tr>
    <tr>
        <td class="left flag">items</td>
        <td class="flag-value">This property specifies an item to populate the set. The "type" for the <code class="clr-code">item</code>
            must conform to the description for it above.
        </td>
    </tr>
    </tbody>
</table>

<p>
    For Service Adapters written in Typescript, the example specification above results in the following code being autogenerated in
    the Service Adapter:
</p>

<pre class="code" ><code class="language-typescript" ngNonBindable>
import &#123; SddcStatus &#125; from './SddcStatus';


const arraySddcReadyStatuses: Array&lt;string&gt; = [
    SddcStatus.Ready,
    SddcStatus.DeployingHosts,
    SddcStatus.DeletingHosts,
    SddcStatus.CreatingCluster,
    SddcStatus.DeletingCluster,
    SddcStatus.DeployHostsCanceling,
    SddcStatus.DeleteHostsCanceling,
    SddcStatus.CreateClusterCanceling,
    SddcStatus.DeleteClusterCanceling,
    SddcStatus.DeployHostsFailed,
    SddcStatus.DeleteHostsFailed,
    SddcStatus.DeleteClusterFailed,
    SddcStatus.CreateClusterFailed,
    SddcStatus.DeployHostsCanceled,
    SddcStatus.DeleteHostsCanceled,
    SddcStatus.CreateClusterCanceled,
    SddcStatus.DeleteClusterCanceled,
    SddcStatus.SrmActivateStarted,
    SddcStatus.SrmActivateFinished,
    SddcStatus.SrmActivateFailed,
    SddcStatus.SrmDeactivateStarted,
    SddcStatus.SrmDeactivateFinished,
    SddcStatus.SrmDeactivateFailed
];

// NOTE: SddcReadyStatuses can only be used internally in SddcCore service. It will not be in the interface YAML.
export const SddcReadyStatuses = new Set&lt;string&gt;(arraySddcReadyStatuses);
</code></pre>

<hr/>

<p>
    That's it! This is all you need to specify custom sets.
</p>
