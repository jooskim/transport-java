<h1>Service Adapter Specification</h1>

<h3>Specification Document: maps.json</h3>

<p>
    By convention, <code class="clr-code">maps.json</code> contains the specifications for generating language-neutral
    dictionaries that map typed key/value pairs for internal use by the Service Adapter, either for customized code,
    or for custom tests. A later chapter will discuss in detail the autogenerated code.
</p>

<p>
    It should be noted that the autogenerated maps are not exposed in the Service Adapter Interface (YAML), and therefore,
    such maps are not directly accessible from the application layer. Moreover, maps are currently not supported for
    Service Adapters written in Java, and are manifest as ES6 Map classes for Service Adapters written in Typescript.
    <br/><br/>
    Maps are a legacy implementation which had hoped to be transportable across multiple languages. We are seeing
    problems in creating standalone maps (not wrapped in a class) in languages other than Typescript, so it may be preferable to use
    <code class="clr-code">custom code</code> instead. In the meantime, we are investigating whether we can come
    up with an alternate solution.
</p>

<p>
    Here is an example of a map excerpted from the <strong class="emphasis">sddc-core</strong> Service Adapter:
</p>

<pre class="code" ><code class="language-json" ngNonBindable>
&#123;
    "maps": [
        &#123;
            "map": "SddcStateNotification",
            "key_type": "string_enum",
            "type": "SddcStateChangeType",
            "imports": [
                &#123; "import": "SddcStateChangeType" &#125;,
                &#123; "import": "TaskStatus", "service": "task" &#125;,
                &#123; "import": "TaskType", "service": "task" &#125;
            ],
            "pairs": [
                &#123; "key": "TaskStatus.Started + TaskType.DeployingSddc", "value": "SddcStateChangeType.SddcCreating", "type":  "enum" &#125;,
                &#123; "key": "TaskStatus.Started + TaskType.DeletingSddc", "value": "SddcStateChangeType.SddcDeleting", "type":  "enum" &#125;,
                &#123; "key": "TaskStatus.Started + TaskType.DeployingEsx", "value": "SddcStateChangeType.SddcAddingHosts", "type":  "enum" &#125;,
</code></pre>
<p>
    In the above, we have specified that we want to create an ES6 Map object named <code class="clr-code">SddcStateNotification</code>.
    This is one of the more complex map specifications which qualifies the type for both the map key and its value, and includes
    string concatenation, and extensions to <code class="clr-code">CommonType</code>. Below is a detailed description of the various
    properties for specifying a map object:
</p>
<table class="table table-noborder flag-table">
    <thead>
    <tr>
        <th class="left flag-header">Property</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="left flag">maps</td>
        <td class="flag-value">This property specifies an array of custom ES6 maps. These maps are only for use within the Service
            Adapter or its custom tests. The instantiated map is not exposed in the Service Interface Document and is, therefore,
            not referable from the application layer.
        </td>
    </tr>
    <tr>
        <td class="left flag">map</td>
        <td class="flag-value">This property specifies the name of each ES6 Map that is to be instantiated. This name is
            referable from the Service Adapter and its mocks and tests, but is not exposed in the Service Adapter Interface
            Document.
        </td>
    </tr>
    <tr>
        <td class="left flag">key_type</td>
        <td class="flag-value">This property specifies the "type" of the <strong class="emphasis">key</strong> for the ES6 Map.
            If it is not specified, then it is assumed to be of type "string". Only base types may be used to specify this,
            with the addition of "string_enum" as used in the example above. It also allows for the provision of string concatenation using
            the "+" operator, something that may not be acceptable in languages other than Typescript and Java.
            <br/><br/>
            The specification of container/nested from <code class="clr-code">CommonType</code> is not permitted here.
        </td>
    </tr>
    <tr>
        <td class="left flag">type</td>
        <td class="flag-value">This property specifies the "type" of the <strong class="emphasis">value</strong> for the ES6 Map.
            The type specification uses container/nested/type from the <code class="clr-code">CommonType</code> described in previous chapters.
        </td>
    </tr>
    <tr>
        <td class="left flag">imports</td>
        <td class="flag-value">Typically, in autogenerating an ES6 Map, <strong class="emphasis">ServGen</strong> is able to infer the
            location where all references within the ES6 Map are defined. In some cases, however, as in the example above, some help is
            required in the form of <code class="clr-code">import</code> specifications to determine the location of some definitions.
            <br/><br/>
            This property contains an array of symbol/location pairs to be searched for definitions. The symbol is declared using the
            <code class="clr-code">import</code> property, while the location is the Service Adapter where it is defined using
            the <code class="clr-code">service</code> property. In the above example, <strong class="emphasis">TaskStatus</strong> is to be
            found in the <strong class="emphasis">task</strong> Service Adapter. Ommision of the <code class="clr-code">service</code>
            property indicates that the symbol is to be searched for in the current Service Adapter, as is the case in the above example
            for the symbol  <strong class="emphasis">SddcStateChangeType</strong>. Instead of providing a location using the
            <code class="clr-code">service</code> property, it is also possible to provide an absolute or relative path to a file
            using the <code class="clr-code">path</code> property thus:
            <br/><br/>
            &nbsp;&nbsp;&#123; "<code class="clr-code">import</code>": "SddcStateChangeType", "<code class="clr-code">path</code>": "./SddcStateChangeType" &#125;
        </td>
    </tr>
    <tr>
        <td class="left flag">pairs</td>
        <td class="flag-value">This property specifies an array of key/value pairs using the properties <code class="clr-code">key</code>
            and <code class="clr-code">value</code> to populate the ES6 Map. The "type" for the <code class="clr-code">key</code> and
            <code class="clr-code">value</code> must conform to the description for these above.
        </td>
    </tr>
    </tbody>
</table>

<p>
    For Service Adapters written in Typescript, the example specification above results in the following code being autogenerated in
    the Service Adapter:
</p>

<pre class="code" ><code class="language-typescript" ngNonBindable>
import &#123; SddcStateChangeType &#125; from './SddcStateChangeType';
import &#123;
    TaskStatus,
    TaskType
&#125; from '../../task';


type SddcStateNotificationTuple = [ string, SddcStateChangeType ];

const SddcStateNotificationArray: Array&lt;SddcStateNotificationTuple&gt; = [
    [ TaskStatus.Started + TaskType.DeployingSddc, SddcStateChangeType.SddcCreating ],
    [ TaskStatus.Started + TaskType.DeletingSddc, SddcStateChangeType.SddcDeleting ],
    [ TaskStatus.Started + TaskType.DeployingEsx, SddcStateChangeType.SddcAddingHosts ],
    :
];

// NOTE: SddcStateNotification can only be used internally in SddcCore service. It will not be in the interface YAML.
export const SddcStateNotification = new Map< string, SddcStateChangeType >(SddcStateNotificationArray);
</code></pre>

<hr/>

<p>
    That's it! This is all you need to specify custom ES6 maps.
</p>
